box: ubuntu

build:
    steps:
        - script:
            name: install-dependencies
            code: sudo apt-get clean && sudo apt-get update && sudo apt-get install -y build-essential pkgconf libasound2-dev libgl1-mesa-dev libx11-dev libudev-dev git
        - script:
            name: gcc-version
            code: gcc --version
        - script:
            name: reicast x64 build
            code: make -C shell/linux platform=x64
        - script:
            name: package app
            code: |
              mkdir s3
              pushd shell/linux
              mv -f nosym-reicast.elf reicast
              gzip reicast
              popd
              mv shell/linux/reicast.gz s3
        - script:
            name: reicast x64 naomi build
            code: make -C shell/linux platform=x64 NAOMI=1
        - script:
            name: package naomi app
            code: |
              pushd shell/linux
              mv -f nosym-reicast.elf reicast_naomi
              gzip reicast_naomi
              popd
              mv shell/linux/reicast_naomi.gz s3
        - s3sync:
            source_dir: s3
            delete-removed: false
            bucket-url: s3://flycast-builds/linux/heads/$WERCKER_GIT_BRANCH-$WERCKER_GIT_COMMIT/
            key-id: AKIAJOZQS4H2PHQWYFCA
            key-secret: $S3_SECRET_KEY
